---
import { getSite } from "../utils/consts";
import HeaderLink from "./HeaderLink.astro";

const site = await getSite();
import SearchModal from "./SearchModal.astro";
import ThemeToggle from "./ThemeToggle.astro";
---

<header class="site-header">
  <nav class="h-full w-full flex items-center justify-end">
    <div
      class="flex items-center gap-2 text-xs 2xl:text-lg text-base-900 hover:text-base-500 font-bold uppercase"
    >
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/blog">Blog</HeaderLink>
      <HeaderLink href="/projects">Projects</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>

      <SearchModal class="text-xs 2xl:text-lg text-base-900 hover:text-base-500 font-bold uppercase" />

      <a
        href="https://github.com/roicort/launchpad"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Visit the GitHub repository"
      >
        GitHub
      </a>
      <button
        id="debug-toggle"
        aria-label="Toggle debug borders"
        aria-pressed="false"
        class="text-xs 2xl:text-lg text-base-900 hover:text-base-500 font-bold uppercase"
      >
        Debug
      </button>
      <ThemeToggle class="text-xs 2xl:text-lg text-base-900 hover:text-base-500 font-bold uppercase" />
    </div>
  </nav>
</header>

<script is:inline>
  const DEBUG_KEY = "debug-borders";

  const applyDebug = (state) => {
    const isOn = state === "on";
    document.documentElement.dataset.debug = isOn ? "on" : "off";
    const button = document.getElementById("debug-toggle");
    if (button) button.setAttribute("aria-pressed", isOn ? "true" : "false");
  };

  const applyNav = (state) => {
    const isOpen = state === "open";
    document.documentElement.dataset.nav = isOpen ? "open" : "closed";
    const button = document.getElementById("nav-toggle");
    if (button) button.setAttribute("aria-pressed", isOpen ? "true" : "false");
  };

  const getPreferredDebug = () => {
    const stored = localStorage.getItem(DEBUG_KEY);
    if (stored === "on" || stored === "off") return stored;
    return "off";
  };

  const toggleDebug = () => {
    const current =
      document.documentElement.dataset.debug === "on" ? "on" : "off";
    const next = current === "on" ? "off" : "on";
    localStorage.setItem(DEBUG_KEY, next);
    applyDebug(next);
  };

  const toggleNav = () => {
    const current =
      document.documentElement.dataset.nav === "open" ? "open" : "closed";
    const next = current === "open" ? "closed" : "open";
    applyNav(next);
  };

  applyDebug(getPreferredDebug());
  applyNav("closed");

  const debugButton = document.getElementById("debug-toggle");
  if (debugButton) {
    debugButton.addEventListener("click", toggleDebug);
  }

  const navButton = document.getElementById("nav-toggle");
  if (navButton) {
    navButton.addEventListener("click", toggleNav);
  }

  const navElement = document.querySelector("nav");
  const navLinks = document.querySelectorAll("nav a");
  navLinks.forEach((link) => {
    link.addEventListener("click", () => applyNav("closed"));
  });

  document.addEventListener("click", (event) => {
    if (document.documentElement.dataset.nav !== "open") return;
    const target = event.target;
    if (!(target instanceof Element)) return;
    const clickedToggle = navButton && navButton.contains(target);
    const clickedNav = navElement && navElement.contains(target);
    if (!clickedToggle && !clickedNav) {
      applyNav("closed");
    }
  });
</script>
